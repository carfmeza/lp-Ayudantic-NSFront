import { Directive, Input, ElementRef, NgZone } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { NativeScriptDebug } from '../trace';
import { RouterExtensions } from './router-extensions';
/**
 * The nsRouterLink directive lets you link to specific parts of your app.
 *
 * Consider the following route configuration:
 * ```
 * [{ path: "/user", component: UserCmp }]
 * ```
 *
 * When linking to this `User` route, you can write:
 *
 * ```
 * <a [nsRouterLink]="["/user"]">link to user component</a>
 * ```
 *
 * NSRouterLink expects the value to be an array of path segments, followed by the params
 * for that level of routing. For instance `["/team", {teamId: 1}, "user", {userId: 2}]`
 * means that we want to generate a link to `/team;teamId=1/user;userId=2`.
 *
 * The first segment name can be prepended with `/`, `./`, or `../`.
 * If the segment begins with `/`, the router will look up the route from the root of the app.
 * If the segment begins with `./`, or doesn"t begin with a slash, the router will
 * instead look in the current component"s children for the route.
 * And if the segment begins with `../`, the router will go up one level.
 */
export class NSRouterLink {
    constructor(ngZone, router, navigator, route, el) {
        this.ngZone = ngZone;
        this.router = router;
        this.navigator = navigator;
        this.route = route;
        this.el = el;
        this.pageTransition = true;
        this.commands = [];
    }
    ngAfterViewInit() {
        this.el.nativeElement.on('tap', () => {
            this.ngZone.run(() => {
                if (NativeScriptDebug.isLogEnabled()) {
                    NativeScriptDebug.routerLog(`nsRouterLink.tapped: ${this.commands} ` + `clear: ${this.clearHistory} ` + `transition: ${JSON.stringify(this.pageTransition)} ` + `duration: ${this.pageTransitionDuration}`);
                }
                const extras = this.getExtras();
                // this.navigator.navigateByUrl(this.urlTree, extras);
                this.navigator.navigate(this.commands, Object.assign(Object.assign({}, extras), { relativeTo: this.route, queryParams: this.queryParams, fragment: this.fragment, preserveQueryParams: attrBoolValue(this.preserveQueryParams), queryParamsHandling: this.queryParamsHandling, preserveFragment: attrBoolValue(this.preserveFragment) }));
            });
        });
    }
    set params(data) {
        if (Array.isArray(data)) {
            this.commands = data;
        }
        else {
            this.commands = [data];
        }
    }
    getExtras() {
        const transition = this.getTransition();
        return {
            skipLocationChange: attrBoolValue(this.skipLocationChange),
            replaceUrl: attrBoolValue(this.replaceUrl),
            clearHistory: this.convertClearHistory(this.clearHistory),
            animated: transition.animated,
            transition: transition.transition,
        };
    }
    get urlTree() {
        const urlTree = this.router.createUrlTree(this.commands, {
            relativeTo: this.route,
            queryParams: this.queryParams,
            fragment: this.fragment,
            preserveQueryParams: attrBoolValue(this.preserveQueryParams),
            queryParamsHandling: this.queryParamsHandling,
            preserveFragment: attrBoolValue(this.preserveFragment),
        });
        if (NativeScriptDebug.isLogEnabled()) {
            NativeScriptDebug.routerLog(`nsRouterLink urlTree created: ${urlTree}`);
        }
        return urlTree;
    }
    convertClearHistory(value) {
        return value === true || value === 'true';
    }
    getTransition() {
        let transition;
        let animated;
        if (typeof this.pageTransition === 'boolean') {
            animated = this.pageTransition;
        }
        else if (typeof this.pageTransition === 'string') {
            if (this.pageTransition === 'none' || this.pageTransition === 'false') {
                animated = false;
            }
            else {
                animated = true;
                transition = {
                    name: this.pageTransition,
                };
            }
        }
        else {
            animated = true;
            transition = this.pageTransition;
        }
        let duration = +this.pageTransitionDuration;
        if (!isNaN(duration)) {
            transition = transition || {};
            transition.duration = duration;
        }
        return { animated, transition };
    }
}
NSRouterLink.decorators = [
    { type: Directive, args: [{ selector: '[nsRouterLink]' },] }
];
NSRouterLink.ctorParameters = () => [
    { type: NgZone },
    { type: Router },
    { type: RouterExtensions },
    { type: ActivatedRoute },
    { type: ElementRef }
];
NSRouterLink.propDecorators = {
    target: [{ type: Input }],
    queryParams: [{ type: Input }],
    fragment: [{ type: Input }],
    queryParamsHandling: [{ type: Input }],
    preserveQueryParams: [{ type: Input }],
    preserveFragment: [{ type: Input }],
    skipLocationChange: [{ type: Input }],
    replaceUrl: [{ type: Input }],
    clearHistory: [{ type: Input }],
    pageTransition: [{ type: Input }],
    pageTransitionDuration: [{ type: Input }],
    params: [{ type: Input, args: ['nsRouterLink',] }]
};
function attrBoolValue(s) {
    return s === '' || !!s;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnMtcm91dGVyLWxpbmsuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9yb3V0ZXIvbnMtcm91dGVyLWxpbmsudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBVyxNQUFNLGlCQUFpQixDQUFDO0FBRWxFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQU12RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Qkc7QUFFSCxNQUFNLE9BQU8sWUFBWTtJQWtCeEIsWUFBb0IsTUFBYyxFQUFVLE1BQWMsRUFBVSxTQUEyQixFQUFVLEtBQXFCLEVBQVUsRUFBYztRQUFsSSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFBVSxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBTDdJLG1CQUFjLEdBQTRDLElBQUksQ0FBQztRQUdoRSxhQUFRLEdBQVUsRUFBRSxDQUFDO0lBRTRILENBQUM7SUFFMUosZUFBZTtRQUNkLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtnQkFDcEIsSUFBSSxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsRUFBRTtvQkFDckMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLHdCQUF3QixJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsVUFBVSxJQUFJLENBQUMsWUFBWSxHQUFHLEdBQUcsZUFBZSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxHQUFHLGFBQWEsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUMsQ0FBQztpQkFDNU07Z0JBRUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUNoQyxzREFBc0Q7Z0JBQ3RELElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLGtDQUNqQyxNQUFNLEtBQ1QsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQ3RCLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUM3QixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFDdkIsbUJBQW1CLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUM1RCxtQkFBbUIsRUFBRSxJQUFJLENBQUMsbUJBQW1CLEVBQzdDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFDckQsQ0FBQztZQUNKLENBQUMsQ0FBQyxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDSixDQUFDO0lBRUQsSUFDSSxNQUFNLENBQUMsSUFBb0I7UUFDOUIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1NBQ3JCO2FBQU07WUFDTixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdkI7SUFDRixDQUFDO0lBRU8sU0FBUztRQUNoQixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDeEMsT0FBTztZQUNOLGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUM7WUFDMUQsVUFBVSxFQUFFLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBRTFDLFlBQVksRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUN6RCxRQUFRLEVBQUUsVUFBVSxDQUFDLFFBQVE7WUFDN0IsVUFBVSxFQUFFLFVBQVUsQ0FBQyxVQUFVO1NBQ2pDLENBQUM7SUFDSCxDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1YsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUN4RCxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUs7WUFDdEIsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXO1lBQzdCLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtZQUN2QixtQkFBbUIsRUFBRSxhQUFhLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzVELG1CQUFtQixFQUFFLElBQUksQ0FBQyxtQkFBbUI7WUFDN0MsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztTQUN0RCxDQUFDLENBQUM7UUFFSCxJQUFJLGlCQUFpQixDQUFDLFlBQVksRUFBRSxFQUFFO1lBQ3JDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxpQ0FBaUMsT0FBTyxFQUFFLENBQUMsQ0FBQztTQUN4RTtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ2hCLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxLQUF1QjtRQUNsRCxPQUFPLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLE1BQU0sQ0FBQztJQUMzQyxDQUFDO0lBRU8sYUFBYTtRQUNwQixJQUFJLFVBQWdDLENBQUM7UUFDckMsSUFBSSxRQUFpQixDQUFDO1FBRXRCLElBQUksT0FBTyxJQUFJLENBQUMsY0FBYyxLQUFLLFNBQVMsRUFBRTtZQUM3QyxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztTQUMvQjthQUFNLElBQUksT0FBTyxJQUFJLENBQUMsY0FBYyxLQUFLLFFBQVEsRUFBRTtZQUNuRCxJQUFJLElBQUksQ0FBQyxjQUFjLEtBQUssTUFBTSxJQUFJLElBQUksQ0FBQyxjQUFjLEtBQUssT0FBTyxFQUFFO2dCQUN0RSxRQUFRLEdBQUcsS0FBSyxDQUFDO2FBQ2pCO2lCQUFNO2dCQUNOLFFBQVEsR0FBRyxJQUFJLENBQUM7Z0JBQ2hCLFVBQVUsR0FBRztvQkFDWixJQUFJLEVBQVUsSUFBSSxDQUFDLGNBQWM7aUJBQ2pDLENBQUM7YUFDRjtTQUNEO2FBQU07WUFDTixRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ2hCLFVBQVUsR0FBeUIsSUFBSSxDQUFDLGNBQWMsQ0FBQztTQUN2RDtRQUVELElBQUksUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDO1FBQzVDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDckIsVUFBVSxHQUFHLFVBQVUsSUFBSSxFQUFFLENBQUM7WUFDOUIsVUFBVSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7U0FDL0I7UUFFRCxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxDQUFDO0lBQ2pDLENBQUM7OztZQWhIRCxTQUFTLFNBQUMsRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUU7OztZQW5DRixNQUFNO1lBRXBCLE1BQU07WUFHdEIsZ0JBQWdCO1lBSGhCLGNBQWM7WUFGSSxVQUFVOzs7cUJBc0NuQyxLQUFLOzBCQUNMLEtBQUs7dUJBQ0wsS0FBSztrQ0FFTCxLQUFLO2tDQUNMLEtBQUs7K0JBQ0wsS0FBSztpQ0FDTCxLQUFLO3lCQUNMLEtBQUs7MkJBRUwsS0FBSzs2QkFDTCxLQUFLO3FDQUNMLEtBQUs7cUJBNEJMLEtBQUssU0FBQyxjQUFjOztBQXdFdEIsU0FBUyxhQUFhLENBQUMsQ0FBTTtJQUM1QixPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgRWxlbWVudFJlZiwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uRXh0cmFzIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIsIFVybFRyZWUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgTmF2aWdhdGlvblRyYW5zaXRpb24gfSBmcm9tICdAbmF0aXZlc2NyaXB0L2NvcmUnO1xuaW1wb3J0IHsgTmF0aXZlU2NyaXB0RGVidWcgfSBmcm9tICcuLi90cmFjZSc7XG5pbXBvcnQgeyBSb3V0ZXJFeHRlbnNpb25zIH0gZnJvbSAnLi9yb3V0ZXItZXh0ZW5zaW9ucyc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uT3B0aW9ucyB9IGZyb20gJy4vbnMtbG9jYXRpb24tdXRpbHMnO1xuXG4vLyBDb3BpZWQgZnJvbSBcIkBhbmd1bGFyL3JvdXRlci9zcmMvY29uZmlnXCJcbmV4cG9ydCB0eXBlIFF1ZXJ5UGFyYW1zSGFuZGxpbmcgPSAnbWVyZ2UnIHwgJ3ByZXNlcnZlJyB8ICcnO1xuXG4vKipcbiAqIFRoZSBuc1JvdXRlckxpbmsgZGlyZWN0aXZlIGxldHMgeW91IGxpbmsgdG8gc3BlY2lmaWMgcGFydHMgb2YgeW91ciBhcHAuXG4gKlxuICogQ29uc2lkZXIgdGhlIGZvbGxvd2luZyByb3V0ZSBjb25maWd1cmF0aW9uOlxuICogYGBgXG4gKiBbeyBwYXRoOiBcIi91c2VyXCIsIGNvbXBvbmVudDogVXNlckNtcCB9XVxuICogYGBgXG4gKlxuICogV2hlbiBsaW5raW5nIHRvIHRoaXMgYFVzZXJgIHJvdXRlLCB5b3UgY2FuIHdyaXRlOlxuICpcbiAqIGBgYFxuICogPGEgW25zUm91dGVyTGlua109XCJbXCIvdXNlclwiXVwiPmxpbmsgdG8gdXNlciBjb21wb25lbnQ8L2E+XG4gKiBgYGBcbiAqXG4gKiBOU1JvdXRlckxpbmsgZXhwZWN0cyB0aGUgdmFsdWUgdG8gYmUgYW4gYXJyYXkgb2YgcGF0aCBzZWdtZW50cywgZm9sbG93ZWQgYnkgdGhlIHBhcmFtc1xuICogZm9yIHRoYXQgbGV2ZWwgb2Ygcm91dGluZy4gRm9yIGluc3RhbmNlIGBbXCIvdGVhbVwiLCB7dGVhbUlkOiAxfSwgXCJ1c2VyXCIsIHt1c2VySWQ6IDJ9XWBcbiAqIG1lYW5zIHRoYXQgd2Ugd2FudCB0byBnZW5lcmF0ZSBhIGxpbmsgdG8gYC90ZWFtO3RlYW1JZD0xL3VzZXI7dXNlcklkPTJgLlxuICpcbiAqIFRoZSBmaXJzdCBzZWdtZW50IG5hbWUgY2FuIGJlIHByZXBlbmRlZCB3aXRoIGAvYCwgYC4vYCwgb3IgYC4uL2AuXG4gKiBJZiB0aGUgc2VnbWVudCBiZWdpbnMgd2l0aCBgL2AsIHRoZSByb3V0ZXIgd2lsbCBsb29rIHVwIHRoZSByb3V0ZSBmcm9tIHRoZSByb290IG9mIHRoZSBhcHAuXG4gKiBJZiB0aGUgc2VnbWVudCBiZWdpbnMgd2l0aCBgLi9gLCBvciBkb2VzblwidCBiZWdpbiB3aXRoIGEgc2xhc2gsIHRoZSByb3V0ZXIgd2lsbFxuICogaW5zdGVhZCBsb29rIGluIHRoZSBjdXJyZW50IGNvbXBvbmVudFwicyBjaGlsZHJlbiBmb3IgdGhlIHJvdXRlLlxuICogQW5kIGlmIHRoZSBzZWdtZW50IGJlZ2lucyB3aXRoIGAuLi9gLCB0aGUgcm91dGVyIHdpbGwgZ28gdXAgb25lIGxldmVsLlxuICovXG5ARGlyZWN0aXZlKHsgc2VsZWN0b3I6ICdbbnNSb3V0ZXJMaW5rXScgfSlcbmV4cG9ydCBjbGFzcyBOU1JvdXRlckxpbmsge1xuXHQvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmRpcmVjdGl2ZS1jbGFzcy1zdWZmaXhcblx0QElucHV0KCkgdGFyZ2V0OiBzdHJpbmc7XG5cdEBJbnB1dCgpIHF1ZXJ5UGFyYW1zOiB7IFtrOiBzdHJpbmddOiBhbnkgfTtcblx0QElucHV0KCkgZnJhZ21lbnQ6IHN0cmluZztcblxuXHRASW5wdXQoKSBxdWVyeVBhcmFtc0hhbmRsaW5nOiBRdWVyeVBhcmFtc0hhbmRsaW5nO1xuXHRASW5wdXQoKSBwcmVzZXJ2ZVF1ZXJ5UGFyYW1zOiBib29sZWFuO1xuXHRASW5wdXQoKSBwcmVzZXJ2ZUZyYWdtZW50OiBib29sZWFuO1xuXHRASW5wdXQoKSBza2lwTG9jYXRpb25DaGFuZ2U6IGJvb2xlYW47XG5cdEBJbnB1dCgpIHJlcGxhY2VVcmw6IGJvb2xlYW47XG5cblx0QElucHV0KCkgY2xlYXJIaXN0b3J5OiBib29sZWFuO1xuXHRASW5wdXQoKSBwYWdlVHJhbnNpdGlvbjogYm9vbGVhbiB8IHN0cmluZyB8IE5hdmlnYXRpb25UcmFuc2l0aW9uID0gdHJ1ZTtcblx0QElucHV0KCkgcGFnZVRyYW5zaXRpb25EdXJhdGlvbjtcblxuXHRwcml2YXRlIGNvbW1hbmRzOiBhbnlbXSA9IFtdO1xuXG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgbmdab25lOiBOZ1pvbmUsIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgbmF2aWdhdG9yOiBSb3V0ZXJFeHRlbnNpb25zLCBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSwgcHJpdmF0ZSBlbDogRWxlbWVudFJlZikge31cblxuXHRuZ0FmdGVyVmlld0luaXQoKSB7XG5cdFx0dGhpcy5lbC5uYXRpdmVFbGVtZW50Lm9uKCd0YXAnLCAoKSA9PiB7XG5cdFx0XHR0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuXHRcdFx0XHRpZiAoTmF0aXZlU2NyaXB0RGVidWcuaXNMb2dFbmFibGVkKCkpIHtcblx0XHRcdFx0XHROYXRpdmVTY3JpcHREZWJ1Zy5yb3V0ZXJMb2coYG5zUm91dGVyTGluay50YXBwZWQ6ICR7dGhpcy5jb21tYW5kc30gYCArIGBjbGVhcjogJHt0aGlzLmNsZWFySGlzdG9yeX0gYCArIGB0cmFuc2l0aW9uOiAke0pTT04uc3RyaW5naWZ5KHRoaXMucGFnZVRyYW5zaXRpb24pfSBgICsgYGR1cmF0aW9uOiAke3RoaXMucGFnZVRyYW5zaXRpb25EdXJhdGlvbn1gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IGV4dHJhcyA9IHRoaXMuZ2V0RXh0cmFzKCk7XG5cdFx0XHRcdC8vIHRoaXMubmF2aWdhdG9yLm5hdmlnYXRlQnlVcmwodGhpcy51cmxUcmVlLCBleHRyYXMpO1xuXHRcdFx0XHR0aGlzLm5hdmlnYXRvci5uYXZpZ2F0ZSh0aGlzLmNvbW1hbmRzLCB7XG5cdFx0XHRcdFx0Li4uZXh0cmFzLFxuXHRcdFx0XHRcdHJlbGF0aXZlVG86IHRoaXMucm91dGUsXG5cdFx0XHRcdFx0cXVlcnlQYXJhbXM6IHRoaXMucXVlcnlQYXJhbXMsXG5cdFx0XHRcdFx0ZnJhZ21lbnQ6IHRoaXMuZnJhZ21lbnQsXG5cdFx0XHRcdFx0cHJlc2VydmVRdWVyeVBhcmFtczogYXR0ckJvb2xWYWx1ZSh0aGlzLnByZXNlcnZlUXVlcnlQYXJhbXMpLFxuXHRcdFx0XHRcdHF1ZXJ5UGFyYW1zSGFuZGxpbmc6IHRoaXMucXVlcnlQYXJhbXNIYW5kbGluZyxcblx0XHRcdFx0XHRwcmVzZXJ2ZUZyYWdtZW50OiBhdHRyQm9vbFZhbHVlKHRoaXMucHJlc2VydmVGcmFnbWVudCksXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblxuXHRASW5wdXQoJ25zUm91dGVyTGluaycpXG5cdHNldCBwYXJhbXMoZGF0YTogYW55W10gfCBzdHJpbmcpIHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xuXHRcdFx0dGhpcy5jb21tYW5kcyA9IGRhdGE7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuY29tbWFuZHMgPSBbZGF0YV07XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBnZXRFeHRyYXMoKTogTmF2aWdhdGlvbkV4dHJhcyAmIE5hdmlnYXRpb25PcHRpb25zIHtcblx0XHRjb25zdCB0cmFuc2l0aW9uID0gdGhpcy5nZXRUcmFuc2l0aW9uKCk7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNraXBMb2NhdGlvbkNoYW5nZTogYXR0ckJvb2xWYWx1ZSh0aGlzLnNraXBMb2NhdGlvbkNoYW5nZSksXG5cdFx0XHRyZXBsYWNlVXJsOiBhdHRyQm9vbFZhbHVlKHRoaXMucmVwbGFjZVVybCksXG5cblx0XHRcdGNsZWFySGlzdG9yeTogdGhpcy5jb252ZXJ0Q2xlYXJIaXN0b3J5KHRoaXMuY2xlYXJIaXN0b3J5KSxcblx0XHRcdGFuaW1hdGVkOiB0cmFuc2l0aW9uLmFuaW1hdGVkLFxuXHRcdFx0dHJhbnNpdGlvbjogdHJhbnNpdGlvbi50cmFuc2l0aW9uLFxuXHRcdH07XG5cdH1cblxuXHRnZXQgdXJsVHJlZSgpOiBVcmxUcmVlIHtcblx0XHRjb25zdCB1cmxUcmVlID0gdGhpcy5yb3V0ZXIuY3JlYXRlVXJsVHJlZSh0aGlzLmNvbW1hbmRzLCB7XG5cdFx0XHRyZWxhdGl2ZVRvOiB0aGlzLnJvdXRlLFxuXHRcdFx0cXVlcnlQYXJhbXM6IHRoaXMucXVlcnlQYXJhbXMsXG5cdFx0XHRmcmFnbWVudDogdGhpcy5mcmFnbWVudCxcblx0XHRcdHByZXNlcnZlUXVlcnlQYXJhbXM6IGF0dHJCb29sVmFsdWUodGhpcy5wcmVzZXJ2ZVF1ZXJ5UGFyYW1zKSxcblx0XHRcdHF1ZXJ5UGFyYW1zSGFuZGxpbmc6IHRoaXMucXVlcnlQYXJhbXNIYW5kbGluZyxcblx0XHRcdHByZXNlcnZlRnJhZ21lbnQ6IGF0dHJCb29sVmFsdWUodGhpcy5wcmVzZXJ2ZUZyYWdtZW50KSxcblx0XHR9KTtcblxuXHRcdGlmIChOYXRpdmVTY3JpcHREZWJ1Zy5pc0xvZ0VuYWJsZWQoKSkge1xuXHRcdFx0TmF0aXZlU2NyaXB0RGVidWcucm91dGVyTG9nKGBuc1JvdXRlckxpbmsgdXJsVHJlZSBjcmVhdGVkOiAke3VybFRyZWV9YCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHVybFRyZWU7XG5cdH1cblxuXHRwcml2YXRlIGNvbnZlcnRDbGVhckhpc3RvcnkodmFsdWU6IGJvb2xlYW4gfCBzdHJpbmcpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09ICd0cnVlJztcblx0fVxuXG5cdHByaXZhdGUgZ2V0VHJhbnNpdGlvbigpOiB7IGFuaW1hdGVkOiBib29sZWFuOyB0cmFuc2l0aW9uPzogTmF2aWdhdGlvblRyYW5zaXRpb24gfSB7XG5cdFx0bGV0IHRyYW5zaXRpb246IE5hdmlnYXRpb25UcmFuc2l0aW9uO1xuXHRcdGxldCBhbmltYXRlZDogYm9vbGVhbjtcblxuXHRcdGlmICh0eXBlb2YgdGhpcy5wYWdlVHJhbnNpdGlvbiA9PT0gJ2Jvb2xlYW4nKSB7XG5cdFx0XHRhbmltYXRlZCA9IHRoaXMucGFnZVRyYW5zaXRpb247XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YgdGhpcy5wYWdlVHJhbnNpdGlvbiA9PT0gJ3N0cmluZycpIHtcblx0XHRcdGlmICh0aGlzLnBhZ2VUcmFuc2l0aW9uID09PSAnbm9uZScgfHwgdGhpcy5wYWdlVHJhbnNpdGlvbiA9PT0gJ2ZhbHNlJykge1xuXHRcdFx0XHRhbmltYXRlZCA9IGZhbHNlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0YW5pbWF0ZWQgPSB0cnVlO1xuXHRcdFx0XHR0cmFuc2l0aW9uID0ge1xuXHRcdFx0XHRcdG5hbWU6IDxzdHJpbmc+dGhpcy5wYWdlVHJhbnNpdGlvbixcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0YW5pbWF0ZWQgPSB0cnVlO1xuXHRcdFx0dHJhbnNpdGlvbiA9IDxOYXZpZ2F0aW9uVHJhbnNpdGlvbj50aGlzLnBhZ2VUcmFuc2l0aW9uO1xuXHRcdH1cblxuXHRcdGxldCBkdXJhdGlvbiA9ICt0aGlzLnBhZ2VUcmFuc2l0aW9uRHVyYXRpb247XG5cdFx0aWYgKCFpc05hTihkdXJhdGlvbikpIHtcblx0XHRcdHRyYW5zaXRpb24gPSB0cmFuc2l0aW9uIHx8IHt9O1xuXHRcdFx0dHJhbnNpdGlvbi5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuXHRcdH1cblxuXHRcdHJldHVybiB7IGFuaW1hdGVkLCB0cmFuc2l0aW9uIH07XG5cdH1cbn1cblxuZnVuY3Rpb24gYXR0ckJvb2xWYWx1ZShzOiBhbnkpOiBib29sZWFuIHtcblx0cmV0dXJuIHMgPT09ICcnIHx8ICEhcztcbn1cbiJdfQ==